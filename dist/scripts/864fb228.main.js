(function(){var a,b,c,d,e,f,g,h,i,j,k;a=function(){function a(a,b){var c,d,e,f,g;for(this.n=a,this.m=b,this.grid=[],this.neighbors=[],c=f=0,g=a-1;g>=0?g>=f:f>=g;c=g>=0?++f:--f)e=function(){var a,c,e;for(e=[],d=a=0,c=b-1;c>=0?c>=a:a>=c;d=c>=0?++a:--a)e.push(0);return e}(),this.grid.push(e),this.neighbors.push(e.slice())}return a.prototype.randomize=function(){var a,b,c,d,e,f;for(f=[],a=d=0,e=this.n-1;e>=0?e>=d:d>=e;a=e>=0?++d:--d)c=this.grid[a],f.push(function(){var a,d,e;for(e=[],b=a=0,d=this.m-1;d>=0?d>=a:a>=d;b=d>=0?++a:--a)e.push(c[b]=Math.random()<.3?1:0);return e}.call(this));return f},a.prototype.updateNeighbors=function(){var a,b,c,d,e,f;for(f=[],a=d=0,e=this.n-1;e>=0?e>=d:d>=e;a=e>=0?++d:--d)f.push(function(){var d,e,f;for(f=[],b=d=0,e=this.m-1;e>=0?e>=d:d>=e;b=e>=0?++d:--d)c=0,a>0&&(1===this.grid[a-1][b]&&c++,b>0&&(1===this.grid[a-1][b-1]&&c++,1===this.grid[a][b-1]&&c++),b<this.m-1&&(1===this.grid[a-1][b+1]&&c++,1===this.grid[a][b+1]&&c++)),a<this.n-1&&(1===this.grid[a+1][b]&&c++,b>0&&1===this.grid[a+1][b-1]&&c++,b<this.m-1&&1===this.grid[a+1][b+1]&&c++),f.push(this.neighbors[a][b]=c);return f}.call(this));return f},a.prototype.step=function(a){var b,c,d,e,f,g,h;for(h=[],b=f=0,g=this.n-1;g>=0?g>=f:f>=g;b=g>=0?++f:--f)h.push(function(){var f,g,h;for(h=[],c=f=0,g=this.m-1;g>=0?g>=f:f>=g;c=g>=0?++f:--f)e=this.grid[b][c],d=this.neighbors[b][c],h.push(this.grid[b][c]=a(e,d));return h}.call(this));return h},a}(),f=function(a,b){var c,d,f,h,i,j,l,m,n;for(j=k/b.n,d=g/b.m,n=[],f=l=0,m=b.n-1;m>=0?m>=l:l>=m;f=m>=0?++l:--l)i=b.grid[f],n.push(function(){var a,g,k;for(k=[],h=a=0,g=b.m-1;g>=0?g>=a:a>=g;h=g>=0?++a:--a)c=i[h],k.push(1===c?e.rect(f*j,h*d,j,d):void 0);return k}());return n},i=function(a,b){var c;return c=1===a,c?2===b||3===b?1:0:3===b?1:0},k=400,g=400,c=document.createElement("canvas"),c.width=k,c.height=g,d=document.getElementById("main"),d.appendChild(c),e=c.getContext("2d"),e.fillStyle="red",b=new a(200,200),b.randomize(),b.updateNeighbors(),h=function(){return e.clearRect(0,0,k,g),e.beginPath(),f(c,b),e.fill(),b.step(i),b.updateNeighbors()},setInterval(h,80),j=function(a){return _.reduce(a,function(a,b){var c,d,e,f;for(e=0,f=b.length;f>e;e++)d=b[e],c=1===d?"@ ":". ",a+=c;return a+="\n"},"")}}).call(this);